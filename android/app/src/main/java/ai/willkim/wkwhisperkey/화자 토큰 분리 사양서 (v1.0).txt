화자 토큰 분리 사양서 (v1.0)

1️⃣ 입력
- 마이크 N (예: 4)
- 샘플링율 16 kHz 이상
- 프레임 길이 20 ms (50 % 오버랩)

2️⃣ 기본 처리
- 루트 음원 = 모든 마이크 신호 평균
- 대표ₘ = (음원ₘ − 루트)
- 각 대표 신호 → FFT 8 주파수 대역 추출
- 복소 스펙트럼 → 위상 Δφₘₖ 및 에너지 Eₘₖ 산출

3️⃣ 발성 키 판별
- 8 주파수 연립방정식에서 ≥ 2 (혼잡 시 3) 주파수 일치 → 발성 키 인정
- R² > 0.9 및 잔차 < π/6 유지
- 모호 주파수 (Δφ 분산 ↑) → 무시 또는 가중 분배 // TODO: 후속 버전

4️⃣ 화자 추출 및 핸드오버
- 대표ₘ 위상키 Δφ₀ₘ 기준 단일 화자면 대표 자체 = 화자
- 다중 화자면 모호 주파수 분리 → 화자ᵢₘ 등록
- 이동 시 Δφ 거리 > θ_thr → 인접 대표로 핸드오버
- 루트 = 절대 기준 (삭제 불가)

5️⃣ 음 토큰 계산
- 각 활성 발성 키 → 8 주파수 에너지·위상 → 16 비트 토큰 (2 비트 × 8)
- 신호 없음 → 0x0000
- 프레임별 출력 예시:
ROOT  0x0F3A
REP0  0x2B10  0x312F
REP1  0x0000
REP2  0x9C45

6️⃣ 인식 전달 
- 토큰 배열 → AI 또는 테이블 룩업 모듈에 전송
- 인식기 선택 자유 (AI 모델, N-gram 룩업 등)

7️⃣ 성능 기준
- 엔드-투-엔드 지연 ≤ 60 ms
- CPU 사용률 (모바일) ≤ 5 %
- 위상 오차 (σφ) ≤ 15°
- 발성키 검출 정확도 ≥ 95 %

8️⃣ 주파수 구성 및 토큰 매핑 (v1.0a)

1. 주파수 세트
f₀ = 150 Hz  → 성대 검출용 (Voicing)
f₁ = 700 Hz  → 속삭임 기본대역
f₂ = 1100 Hz → 포먼트 저역
f₃ = 1700 Hz → 포먼트 중역
f₄ = 2500 Hz → 포먼트 고역
f₅ = 3600 Hz → 공기 공명대
f₆ = 5200 Hz → 예리한 자음
f₇ = 7500 Hz → 노이즈 / 히스

• 배수 관계를 피한 비정수 간격으로 정수해 최소화
• 마이크 간격 약 2cm 기준, 위상 분해 한계 내에서 안정 검출

2. 토큰 비트맵 (16비트)
b15..b2 : f₁~f₇ → 각 2비트 (에너지 4단계)
b1..b0  : f₀ (150Hz) → 2비트 성대음 세기

성대음 비트(f₀): 00 없음 / 01 약함 / 10 중간 / 11 강함
속삭임 밴드(f₁~f₇): 각 00~11 단계별 에너지
